# Vosk语音识别集成说明

## 概述
本项目已成功集成Vosk离线语音识别功能，支持中文语音控制智能家居设备。语音识别采用离线模式，无需网络连接，保护用户隐私。

## 🌟 最新功能特性

### 语音控制优化
- **智能命令解析**：支持多种表达方式的语音命令
- **设备状态同步**：语音命令与UI状态保持同步
- **多设备支持**：支持控制多个LED灯（LED1、LED2、LED3）
- **实时反馈**：显示语音识别结果和命令执行状态

### 支持的语音命令
| 命令类型 | 语音指令 | 功能说明 |
|----------|----------|----------|
| **灯光控制** | "开灯" / "打开灯" | 开启LED灯 |
| | "关灯" / "关闭灯" | 关闭LED灯 |
| | "开灯一" / "开灯1" | 开启LED1 |
| | "开灯二" / "开灯2" | 开启LED2 |
| | "开灯三" / "开灯3" | 开启LED3 |
| **设备控制** | "风扇" / "开风扇" | 控制风扇开关 |
| | "蜂鸣器" / "报警" | 控制蜂鸣器开关 |
| | "门锁" / "锁门" | 控制门锁开关 |
| **批量操作** | "全部关闭" / "关闭所有" | 关闭所有设备 |
| **信息查询** | "天气" / "查询天气" | 查询实时天气信息 |

## 🛠️ 技术实现

### 音频处理配置
- **采样率**：16kHz（Vosk推荐）
- **声道数**：单声道
- **位深度**：16bit
- **音频格式**：PCM
- **字节序**：小端序

### 语音识别流程
1. **音频采集**：实时采集麦克风音频数据
2. **数据缓冲**：将音频数据存储到缓冲区
3. **识别处理**：发送音频数据给Vosk引擎
4. **结果解析**：解析识别结果并执行相应命令
5. **状态更新**：更新UI显示和MQTT消息发送

## 📦 安装配置

### 1. 下载Vosk中文模型

#### 方法1：官方下载
1. 访问Vosk官方模型页面：https://alphacephei.com/vosk/models
2. 下载中文模型：`vosk-model-cn-0.22`
3. 解压到项目根目录的 `models` 文件夹中
4. 确保模型路径为：`models/vosk-model-cn-0.22`

#### 方法2：命令行下载
```bash
# 在项目根目录执行
mkdir models
cd models
wget https://alphacephei.com/vosk/models/vosk-model-cn-0.22.zip
unzip vosk-model-cn-0.22.zip
```

#### 方法3：手动下载
- 模型大小：约1GB
- 下载地址：https://alphacephei.com/vosk/models/vosk-model-cn-0.22.zip
- 解压后确保目录结构：`models/vosk-model-cn-0.22/`

### 2. 依赖库配置

#### OpenBLAS数学库
```bash
# Windows安装步骤
1. 下载OpenBLAS：https://github.com/xianyi/OpenBLAS/releases
2. 解压到合适位置，如：D:\Downloads\APP\OpenBLAS-0.3.29_x64\
3. 在项目配置文件中更新OpenBLAS路径
```

#### 项目依赖库
- `libvosk.dll`：已包含在lib目录中
- Qt多媒体模块：用于音频输入
- Qt网络模块：用于MQTT通信

### 3. 项目配置

#### lamp.pro文件配置
```pro
# 添加Vosk头文件路径
INCLUDEPATH += $$PWD/ui_vosk/include

# 添加Vosk库文件路径
LIBS += -L$$PWD/ui_vosk/lib -lvosk

# 添加OpenBLAS库路径（根据实际安装路径调整）
LIBS += -L"D:/Downloads/APP/OpenBLAS-0.3.29_x64/lib" -lopenblas
```

## 🎯 使用方法

### 基本操作流程
1. **启动应用**：运行编译后的可执行文件
2. **初始化语音**：应用启动时自动初始化语音识别
3. **开始录音**：按住"按住说话"按钮
4. **说出命令**：清晰地说出语音命令
5. **结束录音**：松开按钮进行识别
6. **查看结果**：在语音结果显示区域查看识别结果

### 使用技巧
- **环境要求**：在相对安静的环境中使用
- **发音清晰**：语速适中，发音清晰
- **距离适中**：麦克风距离嘴部20-30cm
- **避免干扰**：避免背景噪音和回声

## 🔧 故障排除

### 常见问题及解决方案

#### 1. 语音模型加载失败
**症状**：应用启动时显示"语音模型加载失败"
**解决方案**：
- 检查模型文件路径是否正确
- 确认模型文件完整性
- 检查文件权限

#### 2. 音频设备无法使用
**症状**：点击语音按钮无反应
**解决方案**：
- 检查麦克风权限设置
- 确认音频驱动正常
- 测试其他音频应用

#### 3. 识别效果不佳
**症状**：语音识别准确率低
**解决方案**：
- 改善使用环境，减少噪音
- 调整麦克风距离和角度
- 检查音频设备质量

#### 4. 编译错误
**症状**：编译时出现链接错误
**解决方案**：
- 检查依赖库路径配置
- 确认所有依赖库已正确安装
- 检查Qt版本兼容性

### 调试信息
启用调试模式查看详细信息：
```cpp
// 在代码中添加调试输出
qDebug() << "语音识别结果:" << recognizedText;
qDebug() << "音频数据大小:" << audioData.size();
```

## 📊 性能优化

### 识别准确率提升
- **音频预处理**：优化音频数据格式
- **模型选择**：使用最新的中文模型
- **环境优化**：改善录音环境

### 响应速度优化
- **实时处理**：优化音频数据缓冲
- **内存管理**：及时释放音频资源
- **线程优化**：避免UI阻塞

## 🔄 更新日志

### v2.0.0 (最新)
- ✅ 集成Vosk离线语音识别引擎
- ✅ 支持多种语音命令表达方式
- ✅ 优化语音控制逻辑，避免UI状态冲突
- ✅ 添加语音识别结果实时显示
- ✅ 支持多设备语音控制
- ✅ 实现语音查询天气功能

### v1.0.0
- ✅ 基础MQTT设备控制
- ✅ 手动按钮控制界面

## 📚 技术参考

### Vosk官方文档
- 官网：https://alphacephei.com/vosk/
- API文档：https://alphacephei.com/vosk/api/
- 模型下载：https://alphacephei.com/vosk/models

### Qt音频处理
- Qt多媒体模块文档
- QAudioInput类使用说明
- 音频格式配置指南

---

**Vosk语音识别** - 让智能家居更懂你！ 🎤✨ 